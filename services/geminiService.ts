import { GoogleGenAI } from "@google/genai";
import { TrainingGoal, FitnessLevel } from "../types";

// Initialize the client with the API key from the environment
const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

export const generateWorkoutPlan = async (
  goal: TrainingGoal,
  level: FitnessLevel,
  duration: number,
  equipment: string
): Promise<string> => {
  try {
    const prompt = `
      –¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä.
      –°–æ—Å—Ç–∞–≤—å –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –°–¢–†–û–ì–û –ø–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ. 
      –ù–ï –ø–∏—à–∏ –Ω–∏–∫–∞–∫–∏—Ö –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏—Ö —Ä–µ—á–µ–π –≤ –Ω–∞—á–∞–ª–µ –∏ –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞.
      –°—Ä–∞–∑—É –≤—ã–¥–∞–≤–∞–π –ø–ª–∞–Ω.
      
      –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
      - –¶–µ–ª—å: ${goal}
      - –£—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏: ${level}
      - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${duration} –º–∏–Ω—É—Ç
      - –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ: ${equipment}
      
      –¢—Ä–µ–±—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ (Markdown):
      ## üèãÔ∏è –ü–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
      
      ### üî• –†–∞–∑–º–∏–Ω–∫–∞ (–≤—Ä–µ–º—è)
      - –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –ø–æ–≤—Ç–æ—Ä—ã/–≤—Ä–µ–º—è
      
      ### üí™ –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å
      - **–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ**: –ø–æ–¥—Ö–æ–¥—ã x –ø–æ–≤—Ç–æ—Ä—ã. –¢–µ—Ö–Ω–∏–∫–∞: –∫—Ä–∞—Ç–∫–æ.
      
      ### üßò –ó–∞–º–∏–Ω–∫–∞ (–≤—Ä–µ–º—è)
      - –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –≤—Ä–µ–º—è
      
      ### üí° –°–æ–≤–µ—Ç —Ç—Ä–µ–Ω–µ—Ä–∞
      (–û–¥–∏–Ω –∫—Ä–∞—Ç–∫–∏–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç –ø–æ —Ç–µ—Ö–Ω–∏–∫–µ –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é)
      
      > (–û–¥–Ω–∞ –∫–æ—Ä–æ—Ç–∫–∞—è —Ü–∏—Ç–∞—Ç–∞)
    `;

    const response = await ai.models.generateContent({
      model: 'gemini-2.5-flash',
      contents: prompt,
    });

    return response.text || "–ò–∑–≤–∏–Ω–∏—Ç–µ, –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
  } catch (error) {
    console.error("Error generating workout:", error);
    return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–≤—è–∑–∏ —Å –ò–ò-—Ç—Ä–µ–Ω–µ—Ä–æ–º. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
  }
};